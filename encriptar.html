<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Inicio</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="css/style.css" rel="stylesheet">
	</head>
	<body >
		<input type='text' id='mensaje' ><br>
		<label>Criptación</label>
		<input type='text' id='cripto' readonly>
		<br>
		<label>Desencriptación</label>
		<input type='text' id='descripto' readonly>
	</body>

		<script type="text/javascript" src='js/jquery-3.2.1.min.js' ></script>
	   <script>

		$(document).ready(function(){
			
			function sortear( abcArray ){
				var newABC = abcArray.slice();
				return newABC.sort( function(a, b){return 0.5 - Math.random()} );
			}

			$('#mensaje').change(function(){
			var letters = 'abcdefghijklmnñopqrstuvwxyz';
			var numbers = '0123456789';
			var mathematicalOperators = '+-*/';
			var punctuationMarks = '.,;:\'"()[]{}¿?¡!-_';
            var abc = letters + numbers + mathematicalOperators + punctuationMarks + ' ';
            //abc = letters;
			var abcArray = abc.split('');
			var newABCArray = sortear(abcArray);

			var indicativo =['a','c'];
			var convenioConfig = [{letra:'a',saltos:2,direccion:'izquierda'},{letra:'p',saltos:4,direccion:'derecha'}];
			var letrasafectadas = [];
			convenioConfig.forEach(function(convenio) {
			    letrasafectadas.push(convenio.letra);
			});
			var texto = $('#mensaje').val();
			var nuevoArreglo = [];
			var indextexto = 0;
			var movimientos = 0;
			
			// ORDENAR INDICATIVO
			var indiceIndicativo = newABCArray.indexOf(indicativo[1]);
			while( nuevoArreglo.length != newABCArray.length ){
				if ( newABCArray[indiceIndicativo] == null ) {
					newABCArray[0];
					indiceIndicativo = -1;
				}
				else 
					nuevoArreglo.push(newABCArray[indiceIndicativo]);
				indiceIndicativo++;
            }
            //FIN ORDENAR INDICATIVO

			var cripto = [];
			var saltos;

			while( cripto.length != texto.length ){
				var buscarletra = '';
				buscarletra = texto.charAt(indextexto);
                
	            var index = abcArray.indexOf(buscarletra) + movimientos;
                if ( nuevoArreglo[index] == undefined ) {
                    index = index - abcArray.length;
                    if( index < 0 ){
                        index+= abcArray.length*2;
                    }
                    var indiceIndicativoAplicable = letrasafectadas.indexOf(buscarletra);
                    cripto.push(nuevoArreglo[ index ]);
                    if ( indiceIndicativoAplicable != -1 ){
                        if(convenioConfig[indiceIndicativoAplicable].direccion == 'derecha'){ 
                            saltos = convenioConfig[indiceIndicativoAplicable].saltos * -1;
                        }else{
                            saltos = convenioConfig[indiceIndicativoAplicable].saltos;
                        }
                        movimientos = movimientos + saltos;
                    }
				    indextexto++;
                }
                else {
                    var indiceIndicativoAplicable = letrasafectadas.indexOf(buscarletra);
                    cripto.push(nuevoArreglo[ index ]);
                    if ( indiceIndicativoAplicable != -1 ){
                        if(convenioConfig[indiceIndicativoAplicable].direccion == 'derecha'){ 
                            saltos = convenioConfig[indiceIndicativoAplicable].saltos * -1;
                        }else{
                            saltos = convenioConfig[indiceIndicativoAplicable].saltos;
                        }
                        movimientos = movimientos + saltos;
                    }
				    indextexto++;
                }
			}
			console.log(abcArray);
			console.log(nuevoArreglo);	
			console.log(texto.split(''));
			console.log(cripto);
		 
            
			//mostrar mensaje

            $('#cripto').val(cripto.join(''));
            
            /* --------------------------------------------------------------------------------------- */



			var desencriptado = [];
            // ORDENAR INDICATIVO
			var initAbcDesencriptar = [];
			var indiceIndicativo = newABCArray.indexOf(indicativo[1]);
			while( initAbcDesencriptar.length != newABCArray.length ){
				if ( newABCArray[indiceIndicativo] == null ) {
					newABCArray[0];
					indiceIndicativo = -1;
				}
				else 
					initAbcDesencriptar.push(newABCArray[indiceIndicativo]);
				indiceIndicativo++;
            }
            var letrasafectadas = [];
			convenioConfig.forEach(function(convenio) {
			    letrasafectadas.push(convenio.letra);
            });
            var criptoString = cripto.join('');

            //FIN ORDENAR INDICATIVO
			var indextexto = 0;
			var movimientos = 0;
			while( desencriptado.length != texto.length ){
				var buscarletra = '';
				buscarletra = criptoString.charAt(indextexto);
	            var index = initAbcDesencriptar.indexOf(buscarletra) + movimientos;
                if ( initAbcDesencriptar[index] == undefined ) {
                    index = index - abcArray.length;
                    if( index < 0 ){
                        index+= abcArray.length*2;
                    }
                    var letraDesencriptada = abcArray[ index ];
                    desencriptado.push(letraDesencriptada);
                    var indiceIndicativoAplicable = letrasafectadas.indexOf(letraDesencriptada);
                    if ( indiceIndicativoAplicable != -1 ){
                        if(convenioConfig[indiceIndicativoAplicable].direccion == 'derecha'){ 
                            saltos = convenioConfig[indiceIndicativoAplicable].saltos;
                        }else{
                            saltos = convenioConfig[indiceIndicativoAplicable].saltos * -1;
                        }
                        movimientos = movimientos + saltos;
                    }
				    indextexto++;
                }
                else {
                    var letraDesencriptada = abcArray[ index ];
                    desencriptado.push(letraDesencriptada);
                    var indiceIndicativoAplicable = letrasafectadas.indexOf(letraDesencriptada);
                    if ( indiceIndicativoAplicable != -1 ){
                        if(convenioConfig[indiceIndicativoAplicable].direccion == 'derecha'){ 
                            saltos = convenioConfig[indiceIndicativoAplicable].saltos;
                        }else{
                            saltos = convenioConfig[indiceIndicativoAplicable].saltos * -1;
                        }
                        movimientos = movimientos + saltos;
                    }
				    indextexto++;
                }
                if(indextexto == 4){
                }
            }
            console.log(desencriptado);
            $('#descripto').val(desencriptado.join(''));
			
		});
  });
	  
		</script>
</html>